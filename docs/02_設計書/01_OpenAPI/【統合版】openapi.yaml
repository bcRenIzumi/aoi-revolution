openapi: 3.1.0
info:
  version: 1.0.0
  title: XXXプロジェクト API仕様書
  description: |
    XXXプロジェクトのAPI仕様書

    ## 1. 概要
    本APIは、XXXプロジェクトのAPI仕様書です。

    ## 2. APIの命名規則

    ### 2.1 タグ名の命名規則

    1. タグ名を表す英単語の、`先頭文字 + 先頭文字以外の最初の子音`を大文字にしたものとする。

    2. 「1.」が既存の接頭辞と重複する場合、2文字目に指定する子音を次のものに送る。
      - 例：認証（authenticate）のグループを追加する際、`AT`の接頭辞が既に存在する → `AH`とする。

    3. 2文字目に指定できる子音がない場合、先頭文字以外の最初の母音を2文字目にする
      - 例：動画（video）のグループを追加する際、`VD`の接頭辞が既に存在する → `VI`とする。

    4. 「3.」が既存の接頭辞と重複する場合、2文字目に指定する母音を次のものに送る。

    ### 2.2 API名の命名規則

    連番2桁＋HTTPメソッドとAPI名を`_`で結合したものとする。

    HTTPメソッドは、`GET`, `POST`, `PUT`, `DELETE`のいずれかを使用し、以下の対応付けとする。
    - GET: 取得（C）
    - POST: 登録（R）
    - PUT: 更新（U）
    - DELETE: 削除（D）

    ## 3. URL設計規則
    - `/{open|secure}/{category}/{function}` の形式で統一
    - open: 認証不要
    - secure: 認証必須
    - category: APIカテゴリに対応
    - function: 具体的な機能名

    ## 4. 環境
    - 開発環境: http://localhost:8080
    - 検証環境: （未定）
    - 本番環境: （未定）
servers:
  - url: http://localhost:8080
    description: 開発環境
tags:
  - name: 認証（AT）
    description: 認証機能
  - name: その他（OT）
    description: システム共通機能
paths:
  /open/auth/register:
    post:
      tags:
        - 認証（AT）
      summary: 01C_認証登録API
      description: 認証登録を行うAPI
      requestBody:
        description: リクエストボディ
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                lineUserId:
                  type: string
                  example: U8189cf6745fc0d808977bdb0b9f22995
                  description: LINEユーザーID
                  minLength: 33
                  maxLength: 33
                cmnCstNo:
                  type: string
                  example: '1234567890'
                  description: 共通顧客番号
                  minLength: 10
                  maxLength: 10
                password:
                  type: string
                  example: password
                  description: パスワード
                  pattern: ^(?!.*?(.)\1{2})(?=.*[0-9])(?=.*[a-zA-Z])[0-9a-zA-Z!#$%&,\-\./=\?@\[\]\^_\{\}~]{8,32}$
                nickname:
                  type: string
                  example: テストユーザー
                  description: ニックネーム
                  maxLength: 12
              required:
                - lineUserId
                - cmnCstNo
                - password
                - nickname
      responses:
        '200':
          description: 成功時の動き
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BaseResponse'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /open/auth/users:
    get:
      tags:
        - 認証（AT）
      summary: 02R_認証会員一覧取得API
      description: 認証済み会員一覧を取得するAPI
      parameters:
        - name: lineUserId
          in: query
          required: true
          schema:
            type: string
            minLength: 33
            maxLength: 33
          example: U8189cf6745fc0d808977bdb0b9f22995
          description: LINEユーザーID
      responses:
        '200':
          description: 成功時の動き
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/BaseResponse'
                  - type: object
                    description: 認証会員一覧取得APIのレスポンスDTO
                    properties:
                      lineUserId:
                        type: string
                        example: U8189cf6745fc0d808977bdb0b9f22995
                        description: LINEユーザーID
                      users:
                        type: array
                        items:
                          type: object
                          properties:
                            id:
                              type: string
                              example: '1'
                              description: 認証ユーザーID
                            cmnCstNo:
                              type: string
                              example: '1234567890'
                              description: 共通顧客番号
                          required:
                            - id
                            - cmnCstNo
        '400':
          $ref: '#/components/responses/BadRequestError'
        '500':
          $ref: '#/components/responses/InternalServerError'
    post:
      tags:
        - 認証（AT）
      summary: 02C_認証会員取得API
      description: 認証済み会員一覧を取得するAPI
      parameters:
        - name: lineUserId
          in: query
          required: true
          schema:
            type: string
            minLength: 33
            maxLength: 33
          example: U8189cf6745fc0d808977bdb0b9f22995
          description: LINEユーザーID
      responses:
        '200':
          description: 成功時の動き
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/BaseResponse'
                  - type: object
                    description: 認証会員一覧取得APIのレスポンスDTO
                    properties:
                      lineUserId:
                        type: string
                        example: U8189cf6745fc0d808977bdb0b9f22995
                        description: LINEユーザーID
                      users:
                        type: array
                        items:
                          type: object
                          properties:
                            id:
                              type: string
                              example: '1'
                              description: 認証ユーザーID
                            cmnCstNo:
                              type: string
                              example: '1234567890'
                              description: 共通顧客番号
                            nickname:
                              type: string
                              example: テストユーザー
                              description: ニックネーム
                            isExpired:
                              type: boolean
                              example: false
                              description: 認証期限切れフラグ（true：期限切れ、false：有効）
                          required:
                            - id
                            - cmnCstNo
                            - nickname
                            - isExpired
                    required:
                      - lineUserId
                      - users
        '400':
          $ref: '#/components/responses/BadRequestError'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /open/other/health-check:
    get:
      tags:
        - その他（OT）
      summary: 01R_ヘルスチェックAPI
      description: サーバーの状態を確認するAPI
      responses:
        '200':
          description: 成功時の動き
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BaseResponse'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '500':
          $ref: '#/components/responses/InternalServerError'
components:
  schemas:
    BaseResponse:
      type: object
      description: 正常系の共通レスポンス
      properties:
        common:
          type: object
          properties:
            processingTime:
              type: string
              example: yyyyMMddHHmmss
              description: 業務日付
          required:
            - processingTime
      required:
        - common
    ErrorResponse:
      type: object
      properties:
        common:
          type: object
          properties:
            processingTime:
              type: string
              example: yyyyMMddHHmmss
              description: 業務日付
            errorCode:
              type: string
              example: EXXXX
              description: エラーコードを表す。エラーコード定義書を参照。
            errorMessage:
              type: string
              example: YYでエラーが発生しました。
              description: エラーメッセージを表す。エラーコード定義書を参照。
          required:
            - processingTime
            - errorCode
            - errorMessage
      required:
        - common
  responses:
    BadRequestError:
      description: パラメータエラー
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    InternalServerError:
      description: 想定外のエラー
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
